<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ðŸš— Controle Uber</title>

<style>
body{font-family:Arial;background:#f4f6f8;margin:0}
.container{max-width:900px;margin:auto;padding:15px}
h2{text-align:center}

.cards{display:flex;gap:10px;flex-wrap:wrap}
.card{flex:1;padding:15px;border-radius:16px;background:#fff;font-weight:bold;text-align:center;box-shadow:0 2px 6px rgba(0,0,0,.08)}

.box{background:#fff;padding:15px;border-radius:16px;margin:20px 0;box-shadow:0 2px 6px rgba(0,0,0,.08)}

button{padding:12px;border-radius:12px;border:none;background:#4caf50;color:#fff;font-size:15px;cursor:pointer;width:100%}
button.red{background:#e53935}
button.gray{background:#607d8b}

.people{display:flex;gap:10px;margin:10px 0}
.people button{background:#ddd;color:#000}

input,select{width:100%;padding:12px;margin:6px 0;border-radius:12px;border:1px solid #ccc;font-size:15px}

table{width:100%;border-collapse:collapse;min-width:500px}
td,th{border-bottom:1px solid #ddd;padding:8px;text-align:center}

.scroll{overflow:auto}

.toast{position:fixed;bottom:20px;left:50%;transform:translateX(-50%);background:#323232;color:#fff;padding:12px 20px;border-radius:20px;display:none}

@media(max-width:600px){.cards{flex-direction:column}}
</style>
</head>

<body>

<div class="toast" id="toast"></div>

<div class="container">
<h2>ðŸš— Controle de Viagens Uber</h2>

<div class="cards">
  <div class="card" id="sIan">Ian: R$ 0,00</div>
  <div class="card" id="sLuan">Luan: R$ 0,00</div>
  <div class="card" id="sJoao">JoÃ£o: R$ 0,00</div>
</div>

<div class="box">
<h3>âž• Nova viagem</h3>
<input type="date" id="data">

<div class="people">
  <button onclick="toggle(this,'Ian')">Ian</button>
  <button onclick="toggle(this,'Luan')">Luan</button>
  <button onclick="toggle(this,'JoÃ£o')">JoÃ£o</button>
</div>

<input type="number" id="valor" placeholder="Valor total">
<button onclick="salvarViagem()">Salvar viagem</button>
</div>

<div class="box">
<h3>ðŸ’¸ Registrar pagamento</h3>
<select id="pagPessoa">
  <option>Ian</option>
  <option>Luan</option>
  <option>JoÃ£o</option>
</select>
<input type="number" id="pagValor" placeholder="Valor pago">
<button onclick="registrarPagamento()">Registrar pagamento</button>
</div>

<div class="box">
<h3>ðŸ“… Resumo mensal</h3>
<div class="scroll">
<table>
<thead>
<tr><th>MÃªs</th><th>Ian</th><th>Luan</th><th>JoÃ£o</th></tr>
</thead>
<tbody id="resumo"></tbody>
</table>
</div>
</div>

<div class="box">
<h3>ðŸ“Š HistÃ³rico</h3>
<div class="scroll">
<table>
<thead>
<tr><th>Data</th><th>Pessoas</th><th>Valor</th><th>AÃ§Ã£o</th></tr>
</thead>
<tbody id="tabela"></tbody>
</table>
</div>
</div>

</div>

<script>
// ===== CONFIG GITHUB =====
const GITHUB_USER = "ianferreiramri";
const GITHUB_REPO = "controle-uber";
const FILE_PATH   = "banco.json";
const BRANCH      = "main";
const TOKEN       = "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";

// ===== APP =====
let banco={viagens:[],pagamentos:[]};
let pessoasSel=[];

fetch('banco.json').then(r=>r.json()).then(d=>{banco=d;renderizar();});

function showToast(msg){
  toast.innerText=msg;
  toast.style.display='block';
  setTimeout(()=>toast.style.display='none',2500);
}

function toggle(btn,p){
  if(pessoasSel.includes(p)){
    pessoasSel=pessoasSel.filter(x=>x!==p);
    btn.style.background='#ddd';
    btn.style.color='#000';
  }else{
    pessoasSel.push(p);
    btn.style.background='#4caf50';
    btn.style.color='#fff';
  }
}

function resetPeople(){
  pessoasSel=[];
  document.querySelectorAll('.people button').forEach(b=>{
    b.style.background='#ddd';
    b.style.color='#000';
  });
}

function salvarViagem(){
  if(!data.value||!valor.value||pessoasSel.length===0)return;
  banco.viagens.push({data:data.value,pessoas:[...pessoasSel],valor:+valor.value});
  resetPeople(); valor.value='';
  renderizar(); salvarNoGitHub();
  showToast('âœ… Viagem salva e sincronizada');
}

function registrarPagamento(){
  if(!pagValor.value)return;
  banco.pagamentos.push({pessoa:pagPessoa.value,valor:+pagValor.value});
  pagValor.value='';
  renderizar(); salvarNoGitHub();
  showToast('ðŸ’¸ Pagamento sincronizado');
}

function apagar(i){
  if(confirm('Apagar viagem?')){
    banco.viagens.splice(i,1);
    renderizar(); salvarNoGitHub();
  }
}

function renderizar(){
  montarTabela(); calcularSaldo(); montarResumo();
}

function montarTabela(){
  tabela.innerHTML='';
  banco.viagens.forEach((r,i)=>{
    tabela.innerHTML+=`
    <tr>
      <td>${r.data}</td>
      <td>${r.pessoas.join(', ')}</td>
      <td>R$ ${r.valor.toFixed(2)}</td>
      <td><button class="red" onclick="apagar(${i})">ðŸ—‘</button></td>
    </tr>`;
  });
}

function calcularSaldo(){
  let s={Ian:0,Luan:0,JoÃ£o:0};
  banco.viagens.forEach(r=>{
    const parte=r.valor/r.pessoas.length;
    r.pessoas.forEach(p=>s[p]+=parte);
  });
  banco.pagamentos.forEach(p=>s[p.pessoa]-=p.valor);
  sIan.innerText=`Ian: R$ ${s.Ian.toFixed(2)}`;
  sLuan.innerText=`Luan: R$ ${s.Luan.toFixed(2)}`;
  sJoao.innerText=`JoÃ£o: R$ ${s.JoÃ£o.toFixed(2)}`;
}

function montarResumo(){
  let res={};
  banco.viagens.forEach(r=>{
    const m=r.data.substring(0,7);
    if(!res[m])res[m]={Ian:0,Luan:0,JoÃ£o:0};
    const parte=r.valor/r.pessoas.length;
    r.pessoas.forEach(p=>res[m][p]+=parte);
  });
  resumo.innerHTML='';
  Object.keys(res).sort().forEach(m=>{
    resumo.innerHTML+=`
    <tr>
      <td>${m}</td>
      <td>R$ ${res[m].Ian.toFixed(2)}</td>
      <td>R$ ${res[m].Luan.toFixed(2)}</td>
      <td>R$ ${res[m].JoÃ£o.toFixed(2)}</td>
    </tr>`;
  });
}

// ===== GITHUB SYNC =====
async function salvarNoGitHub(){
  const url=`https://api.github.com/repos/${GITHUB_USER}/${GITHUB_REPO}/contents/${FILE_PATH}`;
  const res=await fetch(url,{headers:{Authorization:`Bearer ${TOKEN}`}});
  const j=await res.json();

  const content=btoa(unescape(encodeURIComponent(JSON.stringify(banco,null,2))));

  await fetch(url,{
    method:'PUT',
    headers:{Authorization:`Bearer ${TOKEN}`,'Content-Type':'application/json'},
    body:JSON.stringify({
      message:'AtualizaÃ§Ã£o automÃ¡tica do banco',
      content:content,
      sha:j.sha,
      branch:BRANCH
    })
  });
}
</script>

</body>
</html>
